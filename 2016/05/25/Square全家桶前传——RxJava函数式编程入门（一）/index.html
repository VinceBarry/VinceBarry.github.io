<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Square全家桶前传——RxJava函数式编程入门（一） | RoadToGeek技术小屋（少年，别再收藏文章了！）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言：作为Android开发者，构建项目应该更多地把精力放在业务逻辑上，于是一个完整的框架显得十分有价值。而且在搭建框架的过程中可以对软件开发有更深入的理解。于是博主打算开始构建一个完整的属于自己的框架，Square全家桶便是搭建框架的第一选择。接下来我将学习Square的几大著名的框架：RxJava（响应式编程），ButterKnife（依赖注入），Retrofit，Okhttp（网络请求），P">
<meta property="og:type" content="article">
<meta property="og:title" content="Square全家桶前传——RxJava函数式编程入门（一）">
<meta property="og:url" content="http://yoursite.com/2016/05/25/Square全家桶前传——RxJava函数式编程入门（一）/index.html">
<meta property="og:site_name" content="RoadToGeek技术小屋（少年，别再收藏文章了！）">
<meta property="og:description" content="前言：作为Android开发者，构建项目应该更多地把精力放在业务逻辑上，于是一个完整的框架显得十分有价值。而且在搭建框架的过程中可以对软件开发有更深入的理解。于是博主打算开始构建一个完整的属于自己的框架，Square全家桶便是搭建框架的第一选择。接下来我将学习Square的几大著名的框架：RxJava（响应式编程），ButterKnife（依赖注入），Retrofit，Okhttp（网络请求），P">
<meta property="og:updated_time" content="2016-05-31T15:27:04.534Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Square全家桶前传——RxJava函数式编程入门（一）">
<meta name="twitter:description" content="前言：作为Android开发者，构建项目应该更多地把精力放在业务逻辑上，于是一个完整的框架显得十分有价值。而且在搭建框架的过程中可以对软件开发有更深入的理解。于是博主打算开始构建一个完整的属于自己的框架，Square全家桶便是搭建框架的第一选择。接下来我将学习Square的几大著名的框架：RxJava（响应式编程），ButterKnife（依赖注入），Retrofit，Okhttp（网络请求），P">
  
    <link rel="alternate" href="/atom.xml" title="RoadToGeek技术小屋（少年，别再收藏文章了！）" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RoadToGeek技术小屋（少年，别再收藏文章了！）</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">RoadToGeek技术小屋</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Square全家桶前传——RxJava函数式编程入门（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/25/Square全家桶前传——RxJava函数式编程入门（一）/" class="article-date">
  <time datetime="2016-05-25T08:35:15.000Z" itemprop="datePublished">2016-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android快速开发/">Android快速开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Square全家桶前传——RxJava函数式编程入门（一）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>前言：作为Android开发者，构建项目应该更多地把精力放在业务逻辑上，于是一个完整的框架显得十分有价值。而且在搭建框架的过程中可以对软件开发有更深入的理解。于是博主打算开始构建一个完整的属于自己的框架，Square全家桶便是搭建框架的第一选择。接下来我将学习Square的几大著名的框架：RxJava（响应式编程），ButterKnife（依赖注入），Retrofit，Okhttp（网络请求），Picasso（图片加载缓存），EventBus（事件总线），Gson（Json解析）并利用它们来搭建自己的应用框架，下面开始RxJava的学习。</strong></p>
<p>RxJava的github地址：<a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">https://github.com/ReactiveX/RxJava</a><br>RxJava请求图片简单Demo：<a href="https://github.com/VinceBarry/SquareDemo" target="_blank" rel="external">https://github.com/VinceBarry/SquareDemo</a><br>给Android开发者的RxJava详解：<a href="http://gank.io/post/560e15be2dca930e00da1083#toc_1" target="_blank" rel="external">http://gank.io/post/560e15be2dca930e00da1083#toc_1</a><br>深入浅出RxJava：<a href="http://blog.csdn.net/lzyzsd/article/details/41833541" target="_blank" rel="external">http://blog.csdn.net/lzyzsd/article/details/41833541</a></p>
<hr>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在说明RxJava是什么之前，先大概说一下设计模式中的观察者模式（Publish–subscribe_pattern）。维基百科上的定义是这样的：In software architecture, publish–subscribe is a messaging pattern where senders of messages, called publishers, do not program the messages to be sent directly to specific receivers, called subscribers, but instead characterize published messages into classes without knowledge of which subscribers, if any, there may be. Similarly, subscribers express interest in one or more classes and only receive messages that are of interest, without knowledge of which publishers, if any, there are.也就是说，观察者模式包含两个对象：Publisher（事件源）和Subscribe（观察者）。事件源不关心自己应该把消息传递给哪些接收器，在它本身的状态改变时主动发出通知，而观察者则关心自己关联的事件源本身是否发生变化，一旦变化便做出响应。RxJava基本采用了观察者模式，利用观察者模式实现一些异步的操作。RxJava优点在于其相比Handler和AsyncTask而言逻辑简洁。下面博主利用使用RxJava来实现异步请求下载网络图片并将其加载在本地控件上的例子来讲解RxJava的基本使用。<strong>基本概念用粗体标出。</strong>由于我也是新手，存在疏漏请指正。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p><strong>RxJava的四个基本概念：Observable (可观察者，即被观察者)、 Observer (观察者)、 subscribe (订阅)、事件。实质上就是观察者模式的基本概念。被观察者通过subscribe()方法与观察者实现订阅关系，之后一有事件发出就通知观察者。</strong><br>先导入依赖：<br>OK，很明显我们需要先把基础的思路理清：我们将通过事件源来实现在IO线程中获取并下载图片，一旦下载完成，便通知订阅者，订阅者在主线程中做出相应（弹出Toast“下载完成”）。新建事件源的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new Observable.OnSubscribe&lt;Bitmap&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void call(Subscriber&lt;? super Bitmap&gt; subscriber) &#123;</span><br><span class="line">                Bitmap bitmap = null;</span><br><span class="line">                try &#123;</span><br><span class="line">                    bitmap = Picasso.with(context).load(url).get();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                if (bitmap == null) &#123;</span><br><span class="line">                    subscriber.onError(new Exception(&quot;Couldn&apos;t download the picture&quot;));</span><br><span class="line">                &#125;</span><br><span class="line">                subscriber.onNext(bitmap);</span><br><span class="line">                subscriber.onCompleted();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribeOn(Schedulers.io());</span><br></pre></td></tr></table></figure>
<p>上面代码新建了一个存储Bitmap数据的事件源队列，然后通过Picasso库请求网络图片（关于Picasso后面的文章有讲解）获取Bitmap对象，将Bitmap对象塞入事件源并通过onNext()方法通知订阅者。注意subscribeOn(Schedulers.io())方法，<strong>Scheduler调度器</strong>的使用表明事件源在IO线程中进行。关于调度器的用法参见上面的文章。</p>
<p>然后新建一个订阅者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observer&lt;Bitmap&gt; observer = new Observer&lt;Bitmap&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onCompleted() &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onError(Throwable e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onNext(Bitmap bitmap) &#123;</span><br><span class="line">                mIv.setImageBitmap(bitmap);</span><br><span class="line">                Toast.makeText(MainActivity.this,&quot;Picture&quot;,Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>上面的订阅者采用最普遍最容易理解的方式，除了这种方式还有just()和from()两种方式。just(T…): 将传入的参数依次发送出来。from(T[]) / from(Iterable&lt;? extends T&gt;) : 将传入的数组或 Iterable 拆分成具体对象后，依次发送出来。在适当的时候使用这两种方式可以起到节省代码量的作用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Subscription s = RxPic.saveImage(MainActivity.this,&quot;http://img2.imgtn.bdimg.com/it/u=3234625060,3330214688&amp;fm=21&amp;gp=0.jpg&quot;,&quot;Hello&quot;)</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(observer);</span><br><span class="line">        if (this.mCompositeSubscription == null) &#123;</span><br><span class="line">            this.mCompositeSubscription = new CompositeSubscription();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        this.mCompositeSubscription.add(s);</span><br></pre></td></tr></table></figure>
<p>然后就是订阅者订阅事件源，通过将Observer和Observable关联到Subscription，然后使用CompsiteSubscription来添加此Subscription。完成以上操作我们就实现了异步请求网络图片并加载到ImageView中。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>RxJava的使用最主要是理解观察者模式，四个基本概念及其创建，如何订阅事件源和函数式编程（由于本文只是入门介绍，没有提到RxJava的函数编程，读者可以通过上面的链接进行学习，或者阅读博主下一篇博客），具体的Demo也参见上文中的博主的Github，如有错误求指正。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/25/Square全家桶前传——RxJava函数式编程入门（一）/" data-id="cir1zx7ch000zxgyuvf3py7v4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原创/">原创</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/06/04/动手撸一个金馆长表情库——爬虫及异步请求/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          动手撸一个金馆长表情库——爬虫及异步请求
        
      </div>
    </a>
  
  
    <a href="/2016/05/17/SharedPreferences的基本使用及其封装类SPUtils剖析/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">SharedPreferences的基本使用及其封装类SPUtils剖析</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Google官方文档/">Android Google官方文档</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Studio/">Android Studio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-实战/">Android 实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android快速开发/">Android快速开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android知识库/">Android知识库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android第三方开源库/">Android第三方开源库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础知识/">Java基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux学习/">Linux学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python基础知识/">Python基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情随笔/">心情随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原创/">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心情/">心情</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/转载/">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 17.5px;">Android</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/原创/" style="font-size: 20px;">原创</a> <a href="/tags/心情/" style="font-size: 10px;">心情</a> <a href="/tags/翻译/" style="font-size: 12.5px;">翻译</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/25/小话java多线程机制/">小话java多线程机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java注解机制/">小话java注解机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java反射机制/">小话java反射机制</a>
          </li>
        
          <li>
            <a href="/2016/07/19/Android自定义View系列（二）——打造一个仿2K游戏摇杆/">Android自定义View系列（二）——打造一个仿2K游戏摇杆</a>
          </li>
        
          <li>
            <a href="/2016/07/18/Android自定义View系列（一）——打造一个爱心进度条/">Android自定义View系列（一）——打造一个爱心进度条</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 陈颍聪<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>