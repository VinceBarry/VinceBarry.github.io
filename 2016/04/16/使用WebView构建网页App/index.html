<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>使用WebView构建网页App | RoadToGeek技术小屋（少年，别再收藏文章了！）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="写作原因：最近博主打算构建一个Android Web浏览器，而作为浏览器的核心组成，WebView有必要认真学习一遍，下面是我对Google官方指南WebView的翻译，如有疏漏或错误，希望指正，另外如有转载请注明出处，谢谢！Building Web Apps in WebView

如果你想要搭建一个web应用（或者只是一个web页面）作为客户端程序的一个部分，你可以使用WebView来实现。W">
<meta property="og:type" content="article">
<meta property="og:title" content="使用WebView构建网页App">
<meta property="og:url" content="http://yoursite.com/2016/04/16/使用WebView构建网页App/index.html">
<meta property="og:site_name" content="RoadToGeek技术小屋（少年，别再收藏文章了！）">
<meta property="og:description" content="写作原因：最近博主打算构建一个Android Web浏览器，而作为浏览器的核心组成，WebView有必要认真学习一遍，下面是我对Google官方指南WebView的翻译，如有疏漏或错误，希望指正，另外如有转载请注明出处，谢谢！Building Web Apps in WebView

如果你想要搭建一个web应用（或者只是一个web页面）作为客户端程序的一个部分，你可以使用WebView来实现。W">
<meta property="og:updated_time" content="2016-04-16T06:14:24.298Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用WebView构建网页App">
<meta name="twitter:description" content="写作原因：最近博主打算构建一个Android Web浏览器，而作为浏览器的核心组成，WebView有必要认真学习一遍，下面是我对Google官方指南WebView的翻译，如有疏漏或错误，希望指正，另外如有转载请注明出处，谢谢！Building Web Apps in WebView

如果你想要搭建一个web应用（或者只是一个web页面）作为客户端程序的一个部分，你可以使用WebView来实现。W">
  
    <link rel="alternate" href="/atom.xml" title="RoadToGeek技术小屋（少年，别再收藏文章了！）" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RoadToGeek技术小屋（少年，别再收藏文章了！）</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">RoadToGeek技术小屋</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-使用WebView构建网页App" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/16/使用WebView构建网页App/" class="article-date">
  <time datetime="2016-04-16T05:43:34.000Z" itemprop="datePublished">2016-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android-Google官方文档/">Android Google官方文档</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      使用WebView构建网页App
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>写作原因：最近博主打算构建一个Android Web浏览器，而作为浏览器的核心组成，WebView有必要认真学习一遍，下面是我对Google官方指南WebView的翻译，如有疏漏或错误，希望指正，另外如有转载请注明出处，谢谢！</strong><br><a href="http://developer.android.com/guide/webapps/webview.html" target="_blank" rel="external">Building Web Apps in WebView</a></p>
<hr>
<p>如果你想要搭建一个web应用（或者只是一个web页面）作为客户端程序的一个部分，你可以使用WebView来实现。WebView类是Android View类的一个继承类，使用它你可以在你的Activity布局中展示web页面。WebView没有包括任何完整的以开发完成的web浏览器的特征，诸如导航控制或者地址栏。WebView默认下是用于展示一个Web页面的。<br>一个有效的使用WebView的常见的场景是当你想要在你的应用中提供可更新的信息（例如用户协议或者指南）。在你的应用中，你可以创造一个包含WebView的Activity用于展示存在网络端的文档。<br>另一个使用场景是如果你的应用需要频繁向用户提供基于网络请求的数据（如Email）时，你可以使用。这种情况下，你会发现相比实现网络请求，解析数据然后在布局中展示，WebView方便许多。你可以为设备设计一个合理的web页面让你的应用加载web页面。<br>下面的文档向你展示了如何初步使用WebView和如何做一些额外的事情如处理页面导航和绑定来自你web页面的JavaScript到客户端app中。</p>
<p></p><h2><strong>向应用中加入WebView</strong></h2><br>简单地在布局中加入<webview>标签即可。例如，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;WebView  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:id=&quot;@+id/webview&quot;</span><br><span class="line">    android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">    android:layout_height=&quot;fill_parent&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><p></p>
<p>通过loadUrl()方法来载入Web页面，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = (WebView) findViewById(R.id.webview);</span><br><span class="line">myWebView.loadUrl(&quot;http://www.example.com&quot;);</span><br></pre></td></tr></table></figure></p>
<p>为了使上述成功执行，你的应用中需要加入网络访问权限。在manifest文件中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest ... &gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure></p>
<p>以上就是一个基本展示web页面的WebView的搭建过程。</p>
<p></p><h2><strong>在WebView中使用JavaScript</strong></h2><br>如果你希望在你的WebView中使用JavaScript，你必须使WebView的JavaScript可用（enable），你可以使用WebView的getSettings()方法获得WebSettings对象，然后调用WebSettings对象的setJavaScriptEnabled(true)来使JavaScript可用。<br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = (WebView) findViewById(R.id.webview);</span><br><span class="line">WebSettings webSettings = myWebView.getSettings();</span><br><span class="line">webSettings.setJavaScriptEnabled(true);</span><br></pre></td></tr></table></figure><p></p>
<p>WebSettings有一系列其他的有用的设置可供访问。例如，如果你在使用WebView开发一个设计方向明确的web应用，你可以通过setUserAgentSetting定义一个自定义的用户代理字符串（user agent），然后在你的web页面查询请求自定义的用户代理来核实请求你的web页面的客户端是否为你的应用。</p>
<p></p><h2><strong>绑定JavaScript到Android</strong></h2><br>当在你的Android应用中开发一个使用WebView的设计具体web应用时，你可以在你的JavaScript和Android源码之间创建接口。举个例子，你的JavaScript可以调用Android Code去展示一个Dialog，而不是使用JavaScript的alert()函数。（笔者不会JS。。。）<br>例如在你的Application中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class WebAppInterface &#123;</span><br><span class="line">    Context mContext;</span><br><span class="line"></span><br><span class="line">    /** Instantiate the interface and set the context */</span><br><span class="line">    WebAppInterface(Context c) &#123;</span><br><span class="line">        mContext = c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** Show a toast from the web page */</span><br><span class="line">    @JavascriptInterface</span><br><span class="line">    public void showToast(String toast) &#123;</span><br><span class="line">        Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<p>警告：如果你设置你的targetSdkVersion为17甚至更大时，你必须添加’@JavascriptInterface annotation’到任何向JavaScript开放的方法中（此方法必为public）。如果你没有提供annotation，当你在Android4.2或更高版本运行时方法是不可见的。<br>在这个例子中，WebAppInterface类允许web页面通过使用showToast()去创造一个Toast。<br>你可以通过addJavascriptInterface()绑定这个类到在你app运行JavaScript的WebView上并且将接口命名为Android，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView webView = (WebView) findViewById(R.id.webview);</span><br><span class="line">webView.addJavascriptInterface(new WebAppInterface(this), &quot;Android&quot;);</span><br></pre></td></tr></table></figure></p>
<p>这样为跑在WebView上的JavaScript创造了一个名为Android的接口，你的web页面已经有权限访问WebAppInterface类，下面是通过JavaScript实现当用户点击button（Web页面）时弹出一个toast（Android）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot; value=&quot;Say hello&quot; onClick=&quot;showAndroidToast(&apos;Hello Android!&apos;)&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function showAndroidToast(toast) &#123;</span><br><span class="line">        Android.showToast(toast);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>没有必要在JavaScript中为Android接口初始化，WebView自动向Web页面将接口可见化。所以，一点击button，showAndroidToast() 方法使用Android接口去调用WebAppInterface.showToast()方法。<br>笔记：对象在非其构建线程中运行。<br>警告：（精简语意）Google说明通过JavaScript调用Android方法是一种危险的行为，你的Android源码可能会被攻击利用除非所有的HTML和JavaScript都在你的WebView中。</p>
<p></p><h2><strong>处理页面导航</strong></h2><br>当用户点击你WebView上面Web页面的链接时，默认行为是启动一个应用去处理URL。通常，默认的Web浏览器会打开载入目的URL。然而，你可以为你的WebView重写行为使得链接在你的WebView中打开。然后你可以允许用户在他们的历史页面间进行前进后退的导航操作。<br>为了打开用户点击的链接，只需使用setWebViewClient()为你的WebView简单地提供一个WebViewClient，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = (WebView) findViewById(R.id.webview);</span><br><span class="line">myWebView.setWebViewClient(new WebViewClient());</span><br></pre></td></tr></table></figure><p></p>
<p>现在可以实现在你的WebView上载入页面了。<br>如果你希望更多的控制一个链接启动的位置，重写shouldOverrideUrlLoading()。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private class MyWebViewClient extends WebViewClient &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line">        if (Uri.parse(url).getHost().equals(&quot;www.example.com&quot;)) &#123;</span><br><span class="line">            // This is my web site, so do not override; let my WebView load the page</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        // Otherwise, the link is not for a page on my site, so launch another Activity that handles URLs</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>个人注解：如果shouldOverrideUrlLoading(WebView view, String url) 方法返回值为true则当前WebView显示，false则启动外部默认应用显示。</em><br>然后为WebView创建一个新的WebViewClient实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView = (WebView) findViewById(R.id.webview);</span><br><span class="line">myWebView.setWebViewClient(new MyWebViewClient());</span><br></pre></td></tr></table></figure></p>
<p>现在当用户点击链接，系统调用shouldOverrideUrlLoading()检查URL是否为该WebView特定执行的Web页，若是则WebView内启动，否则通过intent通知外部应用（默认程序）来启动Web页。</p>
<p></p><h2><strong>网页历史导航</strong></h2><br>当你的WebView重写URL载入，它将自动积累已浏览的网页的历史记录。你可以通过goBack()和goForward()实现前后导航。<br>例如，下面是如何利用物理后退键来实现向后导航：<p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onKeyDown(int keyCode, KeyEvent event) &#123;</span><br><span class="line">    // Check if the key event was the Back button and if there&apos;s history</span><br><span class="line">    if ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; myWebView.canGoBack()) &#123;</span><br><span class="line">        myWebView.goBack();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    // If it wasn&apos;t the Back key or there&apos;s no web page history, bubble up to the default</span><br><span class="line">    // system behavior (probably exit the activity)</span><br><span class="line">    return super.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>canGoBack()方法返回真如果真的有用户浏览记录。同样，你可以使用canGoForward()去检查是否有forward记录。如果不检查，则一旦到达历史记录的末尾，goBack()和goForward()不做任何事情。</p>
</webview>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/16/使用WebView构建网页App/" data-id="cir1zx7cx001jxgyuq8agww30" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/翻译/">翻译</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/26/一款优秀的数据集展示控件-MaterialRecents/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          一款优秀的数据集展示控件-MaterialRecents
        
      </div>
    </a>
  
  
    <a href="/2016/04/12/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Google官方文档/">Android Google官方文档</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Studio/">Android Studio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-实战/">Android 实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android快速开发/">Android快速开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android知识库/">Android知识库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android第三方开源库/">Android第三方开源库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础知识/">Java基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux学习/">Linux学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python基础知识/">Python基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情随笔/">心情随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原创/">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心情/">心情</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/转载/">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 17.5px;">Android</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/原创/" style="font-size: 20px;">原创</a> <a href="/tags/心情/" style="font-size: 10px;">心情</a> <a href="/tags/翻译/" style="font-size: 12.5px;">翻译</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/25/小话java多线程机制/">小话java多线程机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java注解机制/">小话java注解机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java反射机制/">小话java反射机制</a>
          </li>
        
          <li>
            <a href="/2016/07/19/Android自定义View系列（二）——打造一个仿2K游戏摇杆/">Android自定义View系列（二）——打造一个仿2K游戏摇杆</a>
          </li>
        
          <li>
            <a href="/2016/07/18/Android自定义View系列（一）——打造一个爱心进度条/">Android自定义View系列（一）——打造一个爱心进度条</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 陈颍聪<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>