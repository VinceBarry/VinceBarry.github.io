<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>小话java反射机制 | RoadToGeek技术小屋（少年，别再收藏文章了！）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="写作原因：Java反射注解这一块一直是笔者的盲区，但是Java系开发者都知道这一块的重要性。以熟悉的Android开发为例，通过利用反射注解大神们创造了可以减少大量重复赘余代码和清晰逻辑结构的依赖注入框架。本文也是为日后的依赖注入剖析做预备。由于水平限制，一些地方可能存在疏漏，望指出。

本章先从反射开始吧。java是一门面向对象的语言，java中有一句话概括了这个特点：万物皆对象。平常我们创建的">
<meta property="og:type" content="article">
<meta property="og:title" content="小话java反射机制">
<meta property="og:url" content="http://yoursite.com/2016/07/23/小话java反射机制/index.html">
<meta property="og:site_name" content="RoadToGeek技术小屋（少年，别再收藏文章了！）">
<meta property="og:description" content="写作原因：Java反射注解这一块一直是笔者的盲区，但是Java系开发者都知道这一块的重要性。以熟悉的Android开发为例，通过利用反射注解大神们创造了可以减少大量重复赘余代码和清晰逻辑结构的依赖注入框架。本文也是为日后的依赖注入剖析做预备。由于水平限制，一些地方可能存在疏漏，望指出。

本章先从反射开始吧。java是一门面向对象的语言，java中有一句话概括了这个特点：万物皆对象。平常我们创建的">
<meta property="og:updated_time" content="2016-07-23T03:24:46.028Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小话java反射机制">
<meta name="twitter:description" content="写作原因：Java反射注解这一块一直是笔者的盲区，但是Java系开发者都知道这一块的重要性。以熟悉的Android开发为例，通过利用反射注解大神们创造了可以减少大量重复赘余代码和清晰逻辑结构的依赖注入框架。本文也是为日后的依赖注入剖析做预备。由于水平限制，一些地方可能存在疏漏，望指出。

本章先从反射开始吧。java是一门面向对象的语言，java中有一句话概括了这个特点：万物皆对象。平常我们创建的">
  
    <link rel="alternate" href="/atom.xml" title="RoadToGeek技术小屋（少年，别再收藏文章了！）" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RoadToGeek技术小屋（少年，别再收藏文章了！）</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">RoadToGeek技术小屋</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-小话java反射机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/23/小话java反射机制/" class="article-date">
  <time datetime="2016-07-23T02:16:27.000Z" itemprop="datePublished">2016-07-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java基础知识/">Java基础知识</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      小话java反射机制
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>写作原因：Java反射注解这一块一直是笔者的盲区，但是Java系开发者都知道这一块的重要性。以熟悉的Android开发为例，通过利用反射注解大神们创造了可以减少大量重复赘余代码和清晰逻辑结构的依赖注入框架。本文也是为日后的依赖注入剖析做预备。由于水平限制，一些地方可能存在疏漏，望指出。</strong></p>
<hr>
<p>本章先从反射开始吧。java是一门面向对象的语言，java中有一句话概括了这个特点：万物皆对象。平常我们创建的对象是通过某个类产生的，那么类本身呢？不是说万物皆对象吗？还有基本对象和静态成员变量呢？于是java中便引入定义：类本身也是Class类的实例对象。Class普通类是Class类的对象。一切操作都将使用Object完成，类、数组的引用都可以使用Object进行接收。这就真正实现了万物皆对象的思想。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>那么一个类作为一个对象这个怎么定义呢？有如下三种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Person person = new Person();</span><br><span class="line">Class c1 = Person.class;</span><br><span class="line">//这个实例化说明每个类都有一个静态的成员变量Class;</span><br><span class="line">class c2 = person.getClass();</span><br><span class="line">//通过某个类的对象来获得这个对象的类类型；</span><br><span class="line">Class c3 = Class.forName(&quot;类的具体名&quot;);</span><br><span class="line">//通过类的具体名称（包括包名）来获得；</span><br></pre></td></tr></table></figure>
<p>注意上面c1、c2、c3是相等的，他们都是指向Person这个Class类实例化的对象的。现在我们有了类这个对象（好绕口，其实我们现在要做的就是把所有都看成对象，包括类），我们能做什么呢？我们可以通过这个类对象来调用Class类的方法来实现一些功能。具体有哪些功能呢？</p>
<h2 id="实现动态加载类的功能"><a href="#实现动态加载类的功能" class="headerlink" title="实现动态加载类的功能"></a>实现动态加载类的功能</h2><p>由于反射是在编译之后进行的，所以可以通过反射来绕过编译期加载类，实现运行时动态加载类的效果。这样有什么好处呢？通过动态加载类，我们可以完成功能模块的更新而不需重新编译，在需要某个模块时可以动态添加。具体操作我们通过一个Demo来呈现。下面展示一下这个Demo，比如我们要写一个QQ，除了聊天功能（固定，这里我们使用静态加载作比较），我们还提供各种其他功能供用户选择安装使用，比如QQMusic和QQHealth，用户根据需要安装使用。如果使用静态加载类，要实现以上功能我们只能一次性全部把功能写到QQ这个程序里面，而且就算写进去了日后要升级还是得重新再源代码里面添加加载类，这样及其不合理。这时使用反射动态加载就十分必要了。下面我们写一下这个例子，该例子共有5个类，分别为QQ.java、QQChat.java、QQHealth.java、QQMusic.java、FuncAble.java：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class QQ &#123;</span><br><span class="line">    public static void main(String args[])&#123;</span><br><span class="line">        QQChat chat = new QQChat();</span><br><span class="line">        chat.run();</span><br><span class="line">        //</span><br><span class="line">        System.out.println(&quot;Please input the application you want to open:&quot;);</span><br><span class="line">        Scanner s = new Scanner(System.in);</span><br><span class="line">        String name = s.next();</span><br><span class="line">        try &#123;</span><br><span class="line">            Class health = Class.forName(name);</span><br><span class="line">            FuncAble fa = (FuncAble) health.newInstance();</span><br><span class="line">            fa.run();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>QQ.java中实现了静态加载聊天功能和动态加载其它功能的逻辑。我们根据用户输入的类名来加载类类型并实例化为对象然后调用对象的方法，注意我们使用了FuncAble这个接口。为什么要使用接口呢？这里利用了多态性，通过使用接口来兼容各个类对象的实例化。这样下次在增加新的类功能模块时就不用重新去写QQ类的内部逻辑了，只需实现FuncAble接口然后写我们需要的类的逻辑就行了。</p>
<h2 id="获取类内部信息"><a href="#获取类内部信息" class="headerlink" title="获取类内部信息"></a>获取类内部信息</h2><p>大家一定很好奇IDE的只能提示是怎么实现的吧？没错，它们也是利用反射机制完成的。下面我展示一下利用反射来模拟IDE的智能提示功能。这里我们写了一个类名叫ClassInfo，用该类来获取类的内部信息，详细方法见代码中的注释。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public class ClassInfo &#123;</span><br><span class="line">	//获取方法信息    </span><br><span class="line">	public static void getMethodInfo(Object obj)&#123;</span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">		//获取类类型</span><br><span class="line">        Method[] ms = c.getDeclaredMethods();</span><br><span class="line">		//获取方法对象数组</span><br><span class="line">        for(Method m : ms)&#123;</span><br><span class="line">            String modifierName = Modifier.toString(m.getModifiers());</span><br><span class="line">			//获取修饰符</span><br><span class="line">            String methodName = m.getName();</span><br><span class="line">			//获取方法名</span><br><span class="line">            Class[] paraTypes = m.getParameterTypes();</span><br><span class="line">			//获取形参类类型</span><br><span class="line">            String paraTypeName = &quot;&quot;;</span><br><span class="line">            for(Class para : paraTypes)&#123;</span><br><span class="line">                paraTypeName= paraTypeName + &quot; &quot;+para.getSimpleName();</span><br><span class="line">            &#125;</span><br><span class="line">            Class returnType = m.getReturnType();</span><br><span class="line">            String returnTypeName = returnType.getSimpleName();</span><br><span class="line">			//获取返回类型</span><br><span class="line">            //也可以使用getName(),不过会包含包名</span><br><span class="line">            System.out.println(modifierName +&quot; &quot;+returnTypeName+&quot; &quot;+methodName+&quot;(&quot;+paraTypeName+&quot;)&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	//获取成员信息 </span><br><span class="line">    public static void getFieldInfo(Object obj)&#123;</span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        Field[] fields = c.getDeclaredFields();</span><br><span class="line">		//获取成员对象数组</span><br><span class="line">        for(Field f : fields)&#123;</span><br><span class="line">            String fieldName = f.getName();</span><br><span class="line">			//获取成员名</span><br><span class="line">            Class fieldType = f.getType();</span><br><span class="line">			//获取成员类类型</span><br><span class="line">            int modifier = f.getModifiers();</span><br><span class="line">			//获取修饰符</span><br><span class="line">            String modifierName = Modifier.toString(modifier);</span><br><span class="line">            String fieldTypeName = fieldType.getSimpleName();</span><br><span class="line">            System.out.println(modifierName+&quot; &quot; + fieldTypeName + &quot; &quot;+fieldName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	//获取构造函数信息 </span><br><span class="line">    public static void getConstructorInfo(Object obj)&#123;</span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        Constructor[] constructors = c.getDeclaredConstructors();</span><br><span class="line">		//获取构造函数对象数组</span><br><span class="line">        for(Constructor constructor : constructors)&#123;</span><br><span class="line">            String constructorName = constructor.getName();</span><br><span class="line">			//获取构造函数名</span><br><span class="line">            String paraTypeName = &quot;&quot;;</span><br><span class="line">            Class[] paraTypes = constructor.getParameterTypes();</span><br><span class="line">			//获取形参类类型</span><br><span class="line">            for(Class p : paraTypes)&#123;</span><br><span class="line">                paraTypeName = paraTypeName+&quot; &quot;+p.getSimpleName()+&quot; &quot;;</span><br><span class="line">				//获取形参类型名</span><br><span class="line">            &#125;</span><br><span class="line">            String modifierName = Modifier.toString(c.getModifiers());</span><br><span class="line">            System.out.println(modifierName+&quot; &quot;+constructorName+&quot;(&quot;+paraTypeName+&quot;)&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了这个类，我们就可以根据某个类的实例对象查看该类的方法，成员及构造函数了。</p>
<h2 id="通过反射操作类内部"><a href="#通过反射操作类内部" class="headerlink" title="通过反射操作类内部"></a>通过反射操作类内部</h2><p>这里讲述通过反射操作方法的例子，修改成员变量类似。还记得以前我剖析过鸿洋大神对SP的封装工具类SPUtils。他就是通过反射将SP.Editor里面的apply()方法取出然后调用实现将IO操作异步进行的工作（commit是同步的）。首先应该知道：方法名称和方法的参数列表唯一决定方法。所以我们可以通过类类型的<code>getMethod(name,parameterTypes)</code>获得唯一方法，然后通过方法对象的<code>invoke(对象，参数列表)</code>来实现方法间接操作对象从而调用方法。代码片段见下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">获取方法：名称参数列表</span><br><span class="line">//getDeclaredMethod()</span><br><span class="line">a1 = c.getMethod(name,parameterTypes)</span><br><span class="line">parameterTypes = new Class[]&#123;int.class,int class&#125;;//int.class,int.class</span><br><span class="line">Object o = a1.invoke(对象，new Object[]&#123;10,20&#125;)//方法操作对象(或者对象，10,20)</span><br><span class="line">方法如果没有返回值返回null，有返回值返回具体的值</span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后回答一下前面那个问题：基本数据类型跟void关键字也是类类型，数组也一样。就是说它们也可以是对象，如int.class等。博主写这篇文章真是几经周折，先是eclipse崩溃，然后使用Atom写文章，文章写完后Atom挂掉了……又重写了一遍。不说了，都是泪。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/23/小话java反射机制/" data-id="cir1zx7de001xxgyul9bd3zd1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原创/">原创</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/23/小话java注解机制/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          小话java注解机制
        
      </div>
    </a>
  
  
    <a href="/2016/07/19/Android自定义View系列（二）——打造一个仿2K游戏摇杆/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android自定义View系列（二）——打造一个仿2K游戏摇杆</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Google官方文档/">Android Google官方文档</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Studio/">Android Studio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-实战/">Android 实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android快速开发/">Android快速开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android知识库/">Android知识库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android第三方开源库/">Android第三方开源库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础知识/">Java基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux学习/">Linux学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python基础知识/">Python基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情随笔/">心情随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原创/">原创</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心情/">心情</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/翻译/">翻译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/转载/">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 17.5px;">Android</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/原创/" style="font-size: 20px;">原创</a> <a href="/tags/心情/" style="font-size: 10px;">心情</a> <a href="/tags/翻译/" style="font-size: 12.5px;">翻译</a> <a href="/tags/转载/" style="font-size: 15px;">转载</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/25/小话java多线程机制/">小话java多线程机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java注解机制/">小话java注解机制</a>
          </li>
        
          <li>
            <a href="/2016/07/23/小话java反射机制/">小话java反射机制</a>
          </li>
        
          <li>
            <a href="/2016/07/19/Android自定义View系列（二）——打造一个仿2K游戏摇杆/">Android自定义View系列（二）——打造一个仿2K游戏摇杆</a>
          </li>
        
          <li>
            <a href="/2016/07/18/Android自定义View系列（一）——打造一个爱心进度条/">Android自定义View系列（一）——打造一个爱心进度条</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 陈颍聪<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>